<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>Test of bencode-js &ndash; encoding</title>
    <link rel="stylesheet" type="text/css" href="/test/test.css" />
    <script type="text/javascript" src="/test/mootools.js"></script>
    <script type="text/javascript" src="/lib/bubba.js"></script>
    <script type="text/javascript">
      function assertEncodesAs(id, expected, obj) {
        var actual = Bubba.encode(obj);
        var result = actual == expected ? "passed" : "failed";

        var row = new Element('tr');
        var heading = new Element('th');
        var value = new Element('td');
        var comment = new Element('td');

        row.set('class', result); 

        heading.set('text', id);
        value.set('text', result);

        if (actual != expected) {
          comment.set('html', "expected <q>" + expected + "</q>, but got <q>" + actual + "</q>");
        }

        heading.inject(row);
        value.inject(row);
        comment.inject(row);

        row.inject($('testResults'));
      }

      window.addEvent('domready', function() {
          if (3 instanceof Number) { alert("FOO"); }
          assertEncodesAs("integers", "i42e", 42);
          assertEncodesAs("negative integers", "i-42e", -42);
          assertEncodesAs("strings", "6:foobar", "foobar");
          assertEncodesAs("empty strings", "0:", "");
          assertEncodesAs("strings with spaces", "7:foo bar", "foo bar");
          assertEncodesAs("empty lists", "le", []);
          assertEncodesAs("lists of integers", "li1ei2ei3ee", [1, 2, 3]);
          assertEncodesAs("empty dictionaries", "de", {});
          assertEncodesAs("simple dictionaries", "d3:fooi42ee", {foo: 42});
          assertEncodesAs("dictionaries", "d3:fooi42e3:bari12ee", {foo: 42, bar: 12});
      });
    </script>
  </head>
  <body>
    <h1>Test suite for bencoding JavaScript objects</h1>
    <table id="testResults"></table>
  </body>
</html>
